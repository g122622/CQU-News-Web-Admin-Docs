## ProTable

:::tip æ–‡æ¡£é“¾æ¥ ğŸ“š
https://juejin.cn/post/7166068828202336263#heading-14
:::



## å‰è¨€ ğŸ“–

> ProTable ç»„ä»¶ç›®å‰å·²æ˜¯ `2.0ç‰ˆæœ¬`ğŸŒˆï¼Œåœ¨ [1.0ç‰ˆæœ¬](https://juejin.cn/post/7094890833064755208) ä¸­å¤§å®¶æå‡ºçš„é—®é¢˜ä¸åŠŸèƒ½ä¼˜åŒ–ï¼Œç›®å‰å·²ç»å¾—åˆ°ä¼˜åŒ–å’Œè§£å†³ã€‚

> ğŸ˜€ æ¬¢è¿å¤§å®¶åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°ä»»ä½•é—®é¢˜æˆ–æ›´å¥½çš„æƒ³æ³•ï¼Œéƒ½å¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€ï¼Œæˆ–è€…æˆ‘çš„å¼€æºé¡¹ç›® issues ä¸­æå‡ºã€‚å¦‚æœä½ è§‰å¾—è¿˜ä¸é”™ï¼Œè¯·å¸®æˆ‘ç‚¹ä¸ªå°å°çš„ **Star** ğŸ§¡

## ä¸€ã€åœ¨çº¿é¢„è§ˆ ğŸ‘€

### Linkï¼š[admin.spicyboy.cn](https://link.juejin.cn?target=https%3A%2F%2Fadmin.spicyboy.cn)

## äºŒã€Git ä»“åº“åœ°å€ (æ¬¢è¿ Starâ­â­â­)

### Giteeï¼š[gitee.com/HalseySpicyâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FHalseySpicy%2FGeeker-Admin)

### GitHubï¼š[github.com/HalseySpicyâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHalseySpicy%2FGeeker-Admin)

## ä¸‰ã€ProTable åŠŸèƒ½ ğŸš€ğŸš€ğŸš€

> **ProTable** ç»„ä»¶ç›®å‰ä½¿ç”¨å±æ€§é€ä¼ è¿›è¡Œé‡æ„ï¼Œæ”¯æŒ **el-table && el-table-column** æ‰€æœ‰å±æ€§ã€äº‹ä»¶ã€æ–¹æ³•çš„è°ƒç”¨ï¼Œä¸ä¼šæœ‰ä»»ä½•å¿ƒæ™ºè´Ÿæ‹…ã€‚

- è¡¨æ ¼å†…å®¹è‡ªé€‚åº”å±å¹•å®½é«˜ï¼Œæº¢å‡ºå†…å®¹è¡¨æ ¼å†…éƒ¨æ»šåŠ¨ï¼ˆflex å¸ƒå±€ï¼‰
- è¡¨æ ¼æœç´¢ã€é‡ç½®ã€åˆ†é¡µæŸ¥è¯¢ Hooks å°è£… ï¼ˆé¡µé¢ä½¿ç”¨ä¸ä¼šå­˜åœ¨ä»»ä½•æœç´¢ã€é‡ç½®ã€åˆ†é¡µæŸ¥è¯¢é€»è¾‘ï¼‰
- è¡¨æ ¼æ•°æ®æ“ä½œ Hooks å°è£… ï¼ˆå•æ¡æ•°æ®åˆ é™¤ã€æ‰¹é‡åˆ é™¤ã€é‡ç½®å¯†ç ã€çŠ¶æ€åˆ‡æ¢ç­‰æ“ä½œï¼‰
- è¡¨æ ¼æ•°æ®å¤šé€‰ Hooks å°è£… ï¼ˆæ”¯æŒç°è·¨é¡µå‹¾é€‰æ•°æ®ï¼‰
- è¡¨æ ¼æ•°æ®å¯¼å…¥ç»„ä»¶ã€å¯¼å‡º Hooks å°è£…
- è¡¨æ ¼æœç´¢åŒºåŸŸä½¿ç”¨ Grid å¸ƒå±€é‡æ„ï¼Œæ”¯æŒè‡ªå®šä¹‰å“åº”å¼é…ç½®
- è¡¨æ ¼åˆ†é¡µç»„ä»¶å°è£…ï¼ˆPaginationï¼‰æ”¯æŒé™æ€æ•°æ®åˆ†é¡µ
- è¡¨æ ¼æ•°æ®åˆ·æ–°ã€åˆ—æ˜¾éšã€æœç´¢åŒºåŸŸæ˜¾éšè®¾ç½®
- è¡¨æ ¼é…ç½® columns æ”¯æŒåŠ¨æ€æ›´æ–°ï¼ˆ1.2.0 ç‰ˆæœ¬å¯ç”¨ï¼‰
- è¡¨æ ¼æ”¯æŒè¡Œæ‹–æ‹½æ’åºã€å•é€‰æ¡†è®¾ç½®ï¼ˆ1.2.0 ç‰ˆæœ¬å¯ç”¨ï¼‰
- è¡¨æ ¼é…ç½®æ”¯æŒå¤šçº§ propï¼ˆç¤ºä¾‹ ==> prop: user.detail.nameï¼‰
- å•å…ƒæ ¼å†…å®¹æ ¼å¼åŒ–ã€tag æ ‡ç­¾æ˜¾ç¤ºï¼ˆæœ‰å­—å…¸ enum ä¼šæ ¹æ®å­—å…¸ enum è‡ªåŠ¨æ ¼å¼åŒ–ï¼‰
- æ”¯æŒå¤šçº§è¡¨å¤´ã€è¡¨å¤´å†…å®¹è‡ªå®šä¹‰æ¸²æŸ“ï¼ˆæ”¯æŒä½œç”¨åŸŸæ’æ§½ã€tsx è¯­æ³•ã€h å‡½æ•°ï¼‰
- æ”¯æŒå•å…ƒæ ¼å†…å®¹è‡ªå®šä¹‰æ¸²æŸ“ï¼ˆæ”¯æŒä½œç”¨åŸŸæ’æ§½ã€tsx è¯­æ³•ã€h å‡½æ•°ï¼‰
- é…åˆ TreeFilterã€SelectFilter ç»„ä»¶ä½¿ç”¨æ›´ä½³ï¼ˆé¡¹ç›®ä¸­æœ‰ä½¿ç”¨ç¤ºä¾‹ï¼‰

## å››ã€ProTable åŠŸèƒ½éœ€æ±‚åˆ†æ ğŸ“‘

### é¦–å…ˆæˆ‘ä»¬æ¥çœ‹æ•ˆæœå›¾ï¼ˆæ€»å…±å¯ä»¥åˆ†ä¸ºäº”ä¸ªæ¨¡å—ï¼‰ï¼š

![image.png](https://img2.imgtp.com/2024/04/06/AZrmWwQG.webp)

- 1ã€è¡¨æ ¼æœç´¢åŒºåŸŸ
- 2ã€è¡¨æ ¼æ•°æ®æ“ä½œæŒ‰é’®åŒºåŸŸ
- 3ã€è¡¨æ ¼åŠŸèƒ½æŒ‰é’®åŒºåŸŸ
- 4ã€è¡¨æ ¼ä¸»ä½“å†…å®¹å±•ç¤ºåŒºåŸŸ
- 5ã€è¡¨æ ¼åˆ†é¡µåŒºåŸŸ

### 1ã€è¡¨æ ¼æœç´¢åŒºåŸŸéœ€æ±‚åˆ†æï¼š

> å¯ä»¥çœ‹åˆ°æœç´¢åŒºåŸŸçš„å­—æ®µéƒ½æ˜¯å­˜åœ¨äºè¡¨æ ¼å½“ä¸­çš„ï¼Œå¹¶ä¸”æ¯ä¸ªé¡µé¢çš„æœç´¢ã€é‡ç½®æ–¹æ³•éƒ½æ˜¯ä¸€æ ·çš„é€»è¾‘ï¼Œåªæ˜¯ä¸åŒçš„æŸ¥è¯¢å‚æ•°è€Œå·²ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨ä¼ è¡¨æ ¼é…ç½®é¡¹ **columns** æ—¶ï¼Œç›´æ¥æŒ‡å®šæŸä¸ª **column** çš„ **search** é…ç½®ï¼Œå°±èƒ½æŠŠè¯¥é¡¹å˜ä¸ºæœç´¢é¡¹ï¼Œç„¶åä½¿ç”¨ **el** å­—æ®µå¯ä»¥æŒ‡å®šæœç´¢æ¡†çš„ç±»å‹ï¼Œæœ€åæŠŠè¡¨æ ¼çš„æœç´¢æ–¹æ³•éƒ½å°è£…æˆ **Hooks** é’©å­å‡½æ•°ã€‚é¡µé¢ä¸Šå®Œå…¨å°±ä¸ä¼šå­˜åœ¨ä»»ä½•æœç´¢ã€é‡ç½®é€»è¾‘äº†ã€‚

> åœ¨ **1.0** ç‰ˆæœ¬ä¸­ä½¿ç”¨ **v-if** åˆ¤æ–­å¤ªéº»çƒ¦ï¼Œä¸ºäº†æ›´æ–¹ä¾¿ç”¨æˆ·ä¼ é€’å‚æ•°ï¼Œæœç´¢ç»„ä»¶åœ¨ **2.0** ç‰ˆæœ¬ä¸­é€šè¿‡ **component :is** åŠ¨æ€ç»„ä»¶ && **v-bind** å±æ€§é€ä¼ å®ç°ï¼Œå°†ç”¨æˆ·ä¼ é€’çš„å‚æ•°å…¨éƒ¨é€ä¼ åˆ°ç»„ä»¶ä¸Šï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥ç›´æ¥æ ¹æ® **element** å®˜æ–¹æ–‡æ¡£åœ¨ **props** ä¸­ä¼ é€’å‚æ•°äº†ã€‚ä»¥ä¸‹ä»£ç è¿˜ç»“åˆäº†è‡ªå·±é€»è¾‘ä¸Šçš„ä¸€äº›å¤„ç†ï¼š

```html
<template>
  <component
    :is="column.search?.render ?? `el-${column.search?.el}`"
    v-bind="{ ...handleSearchProps, ...placeholder, searchParam: _searchParam, clearable }"
    v-model.trim="_searchParam[column.search?.key ?? handleProp(column.prop!)]"
    :data="column.search?.el === 'tree-select' ? columnEnum : []"
    :options="['cascader', 'select-v2'].includes(column.search?.el!) ? columnEnum : []"
  >
    <template v-if="column.search?.el === 'cascader'" #default="{ data }">
      <span>{{ data[fieldNames.label] }}</span>
    </template>
    <template v-if="column.search?.el === 'select'">
      <component
        :is="`el-option`"
        v-for="(col, index) in columnEnum"
        :key="index"
        :label="col[fieldNames.label]"
        :value="col[fieldNames.value]"
      ></component>
    </template>
    <slot v-else></slot>
  </component>
</template>

<script setup lang="ts" name="SearchFormItem">
import { computed, inject, ref } from "vue";
import { handleProp } from "@/utils";
import { ColumnProps } from "@/components/ProTable/interface";

interface SearchFormItem {
  column: ColumnProps;
  searchParam: { [key: string]: any };
}
const props = defineProps<SearchFormItem>();

// Re receive SearchParam
const _searchParam = computed(() => props.searchParam);

// åˆ¤æ–­ fieldNames è®¾ç½® label && value && children çš„ key å€¼
const fieldNames = computed(() => {
  return {
    label: props.column.fieldNames?.label ?? "label",
    value: props.column.fieldNames?.value ?? "value",
    children: props.column.fieldNames?.children ?? "children"
  };
});

// æ¥æ”¶ enumMap (el ä¸º select-v2 éœ€å•ç‹¬å¤„ç† enumData)
const enumMap = inject("enumMap", ref(new Map()));
const columnEnum = computed(() => {
  let enumData = enumMap.value.get(props.column.prop);
  if (!enumData) return [];
  if (props.column.search?.el === "select-v2" && props.column.fieldNames) {
    enumData = enumData.map((item: { [key: string]: any }) => {
      return { ...item, label: item[fieldNames.value.label], value: item[fieldNames.value.value] };
    });
  }
  return enumData;
});

// å¤„ç†é€ä¼ çš„ searchProps (el ä¸º tree-selectã€cascader çš„æ—¶å€™éœ€è¦ç»™ä¸‹é»˜è®¤ label && value && children)
const handleSearchProps = computed(() => {
  const label = fieldNames.value.label;
  const value = fieldNames.value.value;
  const children = fieldNames.value.children;
  const searchEl = props.column.search?.el;
  let searchProps = props.column.search?.props ?? {};
  if (searchEl === "tree-select") {
    searchProps = { ...searchProps, props: { ...searchProps.props, label, children }, nodeKey: value };
  }
  if (searchEl === "cascader") {
    searchProps = { ...searchProps, props: { ...searchProps.props, label, value, children } };
  }
  return searchProps;
});

// å¤„ç†é»˜è®¤ placeholder
const placeholder = computed(() => {
  const search = props.column.search;
  if (["datetimerange", "daterange", "monthrange"].includes(search?.props?.type) || search?.props?.isRange) {
    return {
      rangeSeparator: search?.props?.rangeSeparator ?? "è‡³",
      startPlaceholder: search?.props?.startPlaceholder ?? "å¼€å§‹æ—¶é—´",
      endPlaceholder: search?.props?.endPlaceholder ?? "ç»“æŸæ—¶é—´"
    };
  }
  const placeholder = search?.props?.placeholder ?? (search?.el?.includes("input") ? "è¯·è¾“å…¥" : "è¯·é€‰æ‹©");
  return { placeholder };
});

// æ˜¯å¦æœ‰æ¸…é™¤æŒ‰é’® (å½“æœç´¢é¡¹æœ‰é»˜è®¤å€¼æ—¶ï¼Œæ¸…é™¤æŒ‰é’®ä¸æ˜¾ç¤º)
const clearable = computed(() => {
  const search = props.column.search;
  return search?.props?.clearable ?? (search?.defaultValue == null || search?.defaultValue == undefined);
});
</script>
```

> **è¡¨æ ¼æœç´¢é¡¹å¯ä½¿ç”¨ tsx ç»„ä»¶è‡ªå®šä¹‰æ¸²æŸ“**

```html
<script setup lang="tsx">
const columns = reactive<ColumnProps<User.ResUserList>[]>([
   {
    prop: "user.detail.age",
    label: "å¹´é¾„",
    search: {
      // è‡ªå®šä¹‰ search ç»„ä»¶
      render: ({ searchParam }) => {
        return (
          <div class="flx-center">
            <el-input vModel_trim={searchParam.minAge} placeholder="æœ€å°å¹´é¾„" style={{ width: "50%" }} />
            <span class="mr10 ml10">-</span>
            <el-input vModel_trim={searchParam.maxAge} placeholder="æœ€å¤§å¹´é¾„" style={{ width: "50%" }} />
          </div>
        );
      }
    }
  },
];
</script>
```

> è¡¨æ ¼æœç´¢ç»„ä»¶åœ¨ **2.0** ç‰ˆæœ¬ä¸­è¿˜æ”¯æŒäº†å“åº”å¼é…ç½®ï¼Œä½¿ç”¨ **Grid** æ–¹æ³•è¿›è¡Œæ•´ä½“é‡æ„ ğŸ˜‹ã€‚

![åŠ¨ç”».gif](E:\æš‚å­˜\æ–°å»ºæ–‡ä»¶å¤¹ (56)\c415a959108e4af3be10d90a5b85b92ctplv-k3u1fbpfcp-jj-mark3024000q75.webp)

### 2ã€è¡¨æ ¼æ•°æ®æ“ä½œæŒ‰é’®åŒºåŸŸéœ€æ±‚åˆ†æï¼š

> è¡¨æ ¼æ•°æ®æ“ä½œæŒ‰é’®åŸºæœ¬ä¸Šæ¯ä¸ªé¡µé¢éƒ½ä¼šä¸ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ **ä½œç”¨åŸŸæ’æ§½** æ¥å®Œæˆæ¯ä¸ªé¡µé¢çš„æ•°æ®æ“ä½œæŒ‰é’®åŒºåŸŸï¼Œ**ä½œç”¨åŸŸæ’æ§½** å¯ä»¥å°†è¡¨æ ¼å¤šé€‰æ•°æ®ä¿¡æ¯ä» **ProTable** çš„ **Hooks** å¤šé€‰é’©å­å‡½æ•°ä¸­ä¼ åˆ°é¡µé¢ä¸Šä½¿ç”¨ã€‚

> **scope** æ•°æ®ä¸­åŒ…å«ï¼š**selectedListï¼ˆå½“å‰é€‰æ‹©çš„æ•°æ®ï¼‰ã€selectedListIdsï¼ˆå½“å‰é€‰æ‹©çš„æ•°æ®idï¼‰ã€isSelectedï¼ˆå½“å‰æ˜¯å¦é€‰ä¸­çš„æ•°æ®ï¼‰**

```html
<!-- ProTable ä¸­ tableHeader æ’æ§½ -->
<slot name="tableHeader" :selected-list="selectedList" :selected-list-ids="selectedListIds" :is-selected="isSelected" />

<!-- é¡µé¢ä½¿ç”¨ -->
<template #tableHeader="scope">
    <el-button type="primary" :icon="CirclePlus" @click="openDrawer('æ–°å¢')">æ–°å¢ç”¨æˆ·</el-button>
    <el-button type="primary" :icon="Upload" plain @click="batchAdd">æ‰¹é‡æ·»åŠ ç”¨æˆ·</el-button>
    <el-button type="primary" :icon="Download" plain @click="downloadFile">å¯¼å‡ºç”¨æˆ·æ•°æ®</el-button>
    <el-button type="danger" :icon="Delete" plain @click="batchDelete(scope.selectedListIds)" :disabled="!scope.isSelected">æ‰¹é‡åˆ é™¤ç”¨æˆ·</el-button>
</template>
```

### 3ã€è¡¨æ ¼åŠŸèƒ½æŒ‰é’®åŒºåŸŸåˆ†æï¼š

> è¿™å—åŒºåŸŸæ²¡ä»€ä¹ˆç‰¹æ®ŠåŠŸèƒ½ï¼Œåªæœ‰å››ä¸ªæŒ‰é’®ï¼Œå…¶åŠŸèƒ½åˆ†åˆ«ä¸ºï¼š**è¡¨æ ¼æ•°æ®åˆ·æ–°ï¼ˆä¸€ç›´ä¼šæºå¸¦å½“å‰æŸ¥è¯¢å’Œåˆ†é¡µæ¡ä»¶ï¼‰ã€è¡¨æ ¼åˆ—è®¾ç½®ï¼ˆåˆ—æ˜¾éšã€åˆ—æ’åºï¼‰ã€è¡¨æ ¼æœç´¢åŒºåŸŸæ˜¾éšï¼ˆæ–¹ä¾¿å±•ç¤ºæ›´å¤šçš„æ•°æ®ä¿¡æ¯ï¼‰**ã€‚ å¯é€šè¿‡ **toolButton** å±æ€§æ§åˆ¶è¿™å—åŒºåŸŸçš„æ˜¾éšã€‚

### 4ã€è¡¨æ ¼ä¸»ä½“å†…å®¹å±•ç¤ºåŒºåŸŸåˆ†æï¼š

> ğŸ‰ è¯¥åŒºåŸŸæ˜¯æœ€é‡è¦çš„æ•°æ®å±•ç¤ºåŒºåŸŸï¼Œå¯¹äºä½¿ç”¨æœ€å¤šçš„åŠŸèƒ½å°±æ˜¯è¡¨å¤´å’Œå•å…ƒæ ¼å†…å®¹å¯ä»¥è‡ªå®šä¹‰æ¸²æŸ“ï¼Œåœ¨ç¬¬ **1.0** ç‰ˆæœ¬ä¸­ï¼Œè‡ªå®šä¹‰è¡¨å¤´åªæ”¯æŒä¼ å…¥`renderHeader`æ–¹æ³•ï¼Œè‡ªå®šä¹‰å•å…ƒæ ¼å†…å®¹åªæ”¯æŒ`slot`æ’æ§½ã€‚

> ğŸ’¥ ç›®å‰ **2.0** ç‰ˆæœ¬ä¸­ï¼Œè¡¨å¤´æ”¯æŒ`headerRender`æ–¹æ³•ï¼ˆé¿å…ä¸ **el-table-column** ä¸Šçš„å±æ€§é‡åå¯¼è‡´æŠ¥é”™ï¼‰ã€ä½œç”¨åŸŸæ’æ§½ï¼ˆ`column.prop + 'Header'`ï¼‰ä¸¤ç§æ–¹å¼è‡ªå®šä¹‰ï¼Œå•å…ƒæ ¼å†…å®¹æ”¯æŒ`render`æ–¹æ³•å’Œä½œç”¨åŸŸæ’æ§½ï¼ˆ`column ä¸Šçš„ prop å±æ€§`ï¼‰ä¸¤ç§æ–¹å¼è‡ªå®šä¹‰ã€‚

- ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½ï¼š

```html
<!-- ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½è‡ªå®šä¹‰å•å…ƒæ ¼å†…å®¹ username -->
<template #username="scope">
    {{ scope.row.username }}
</template>

<!-- ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½è‡ªå®šä¹‰è¡¨å¤´å†…å®¹ username -->
<template #usernameHeader="scope">
    <el-button type="primary" @click="ElMessage.success('æˆ‘æ˜¯é€šè¿‡ä½œç”¨åŸŸæ’æ§½æ¸²æŸ“çš„è¡¨å¤´')">
        {{ scope.column.label }}
    </el-button>
</template>
```

- ä½¿ç”¨ tsx è¯­æ³•ï¼š

```html
<script setup lang="tsx">
const columns = reactive<ColumnProps<User.ResUserList>[]>([
 {
    prop: "username",
    label: "ç”¨æˆ·å§“å",
    // ä½¿ç”¨ headerRender è‡ªå®šä¹‰è¡¨å¤´
    headerRender: scope => {
      return (
        <el-button
          type="primary"
          onClick={() => {
            ElMessage.success("æˆ‘æ˜¯é€šè¿‡ tsx è¯­æ³•æ¸²æŸ“çš„è¡¨å¤´");
          }}
        >
          {scope.column.label}
        </el-button>
      );
    }
  },
  {
    prop: "status",
    label: "ç”¨æˆ·çŠ¶æ€",
    // ä½¿ç”¨ render è‡ªå®šä¹‰è¡¨æ ¼å†…å®¹
    render: scope => {
      return (
          <el-switch
            model-value={scope.row.status}
            active-text={scope.row.status ? "å¯ç”¨" : "ç¦ç”¨"}
            active-value={1}
            inactive-value={0}
            onClick={() => changeStatus(scope.row)}
          />
        ) 
      );
    }
  },
];
</script>
```

> ğŸ’¢ğŸ’¢ğŸ’¢ **æœ€å¼ºå¤§çš„åŠŸèƒ½ï¼šå¦‚æœä½ æƒ³ä½¿ç”¨ `el-table` çš„ä»»ä½•å±æ€§ã€äº‹ä»¶ï¼Œç›®å‰é€šè¿‡å±æ€§é€ä¼ éƒ½èƒ½æ”¯æŒã€‚**
>
> **å¦‚æœä½ è¿˜ä¸äº†è§£å±æ€§é€ä¼ ï¼Œè¯·é˜…è¯» vue å®˜æ–¹æ–‡æ¡£ï¼š[cn.vuejs.org/guide/compoâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fguide%2Fcomponents%2Fattrs.html)**

- **ProTable ç»„ä»¶ä¸Šçš„ç»‘å®šçš„æ‰€æœ‰å±æ€§å’Œäº‹ä»¶éƒ½ä¼šé€šè¿‡ `v-bind="$attrs"` é€ä¼ åˆ° el-table ä¸Šã€‚**
- **ProTable ç»„ä»¶å†…éƒ¨æš´éœ²äº† el-table DOMï¼Œå¯é€šè¿‡ `proTable.value.element.æ–¹æ³•å` è°ƒç”¨å…¶æ–¹æ³•ã€‚**

```html
<template>
    <el-table
      ref="tableRef"
      v-bind="$attrs" 
    >
    </el-table>
</template>

<script setup lang="ts" name="ProTable">
import { ref } from "vue";
import { ElTable } from "element-plus";

const tableRef = ref<InstanceType<typeof ElTable>>();

defineExpose({ element: tableRef });
</script>
```

### 5ã€è¡¨æ ¼åˆ†é¡µåŒºåŸŸåˆ†æï¼š

> åˆ†é¡µåŒºåŸŸä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„åŠŸèƒ½ï¼Œè¯¥æ”¯æŒçš„éƒ½æ”¯æŒäº†ğŸ¤£ï¼ˆé¡µé¢ä¸Šä½¿ç”¨ ProTable ç»„ä»¶å®Œå…¨ä¸å­˜åœ¨åˆ†é¡µé€»è¾‘ï¼‰

```html
<template>
  <!-- åˆ†é¡µç»„ä»¶ -->
  <el-pagination
    :background="true"
    :current-page="pageable.pageNum"
    :page-size="pageable.pageSize"
    :page-sizes="[10, 25, 50, 100]"
    :total="pageable.total"
    layout="total, sizes, prev, pager, next, jumper"
    @size-change="handleSizeChange"
    @current-change="handleCurrentChange"
  ></el-pagination>
</template>

<script setup lang="ts" name="Pagination">
interface Pageable {
  pageNum: number;
  pageSize: number;
  total: number;
}

interface PaginationProps {
  pageable: Pageable;
  handleSizeChange: (size: number) => void;
  handleCurrentChange: (currentPage: number) => void;
}

defineProps<PaginationProps>();
</script>
```

## äº”ã€ProTable æ–‡æ¡£ ğŸ“š

### 1ã€ProTable å±æ€§ï¼ˆProTablePropsï¼‰ï¼š

> ä½¿ç”¨ `v-bind="$attrs"` é€šè¿‡å±æ€§é€ä¼ å°† **ProTable** ç»„ä»¶å±æ€§å…¨éƒ¨é€ä¼ åˆ° **el-table** ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¯æŒ **el-table** çš„æ‰€æœ‰ **Props** å±æ€§ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜æ‰©å±•äº†ä»¥ä¸‹ **Propsï¼š**
>
> [el-table å±æ€§æ–‡æ¡£é“¾æ¥](https://link.juejin.cn?target=https%3A%2F%2Felement-plus.org%2Fzh-CN%2Fcomponent%2Ftable.html%23table-%E5%B1%9E%E6%80%A7)

| å±æ€§å       | ç±»å‹             | æ˜¯å¦å¿…ä¼  | é»˜è®¤å€¼                                | å±æ€§æè¿°                                                     |
| ------------ | ---------------- | -------- | ------------------------------------- | ------------------------------------------------------------ |
| columns      | ColumnProps      | âœ…        | []                                    | ProTable ç»„ä»¶ä¼šæ ¹æ®æ­¤å­—æ®µæ¸²æŸ“æœç´¢è¡¨å•ä¸è¡¨æ ¼åˆ—ï¼ˆæ”¯æŒåŠ¨æ€æ›´æ–°ï¼‰ï¼Œè¯¦æƒ…è§ ColumnProps |
| data         | Array            | âŒ        | â€”                                     | é™æ€ tableData æ•°æ®ï¼ˆæ”¯æŒåˆ†é¡µï¼‰ï¼Œè‹¥å­˜åœ¨åˆ™ä¸ä¼šä½¿ç”¨ requestApi è¿”å›çš„ data |
| requestApi   | Function         | âŒ        | â€”                                     | è·å–è¡¨æ ¼æ•°æ®çš„è¯·æ±‚ API                                       |
| requestAuto  | Boolean          | âŒ        | true                                  | è¡¨æ ¼åˆå§‹åŒ–æ—¶æ˜¯å¦è‡ªåŠ¨æ‰§è¡Œè¯·æ±‚ API                             |
| requestError | Function         | âŒ        | â€”                                     | è¡¨æ ¼ API è¯·æ±‚é”™è¯¯ç›‘å¬                                        |
| dataCallback | Function         | âŒ        | â€”                                     | åå°è¿”å›æ•°æ®çš„å›è°ƒå‡½æ•°ï¼Œå¯å¯¹åå°è¿”å›æ•°æ®è¿›è¡Œå¤„ç†             |
| title        | String           | âŒ        | â€”                                     | è¡¨æ ¼æ ‡é¢˜ï¼Œç›®å‰æ²¡æœ‰ç”¨åˆ°                                       |
| pagination   | Boolean          | âŒ        | true                                  | æ˜¯å¦æ˜¾ç¤ºåˆ†é¡µç»„ä»¶ï¼špagination ä¸º false åå°è¿”å›æ•°æ®åº”è¯¥æ²¡æœ‰åˆ†é¡µä¿¡æ¯ å’Œ list å­—æ®µï¼Œdata å°±æ˜¯ list æ•°æ® |
| initParam    | Object           | âŒ        | {}                                    | è¡¨æ ¼è¯·æ±‚çš„åˆå§‹åŒ–å‚æ•°ï¼Œè¯¥å€¼å˜åŒ–ä¼šé‡æ–°è¯·æ±‚è¡¨æ ¼æ•°æ®             |
| toolButton   | Boolean \| Array | âŒ        | true                                  | æ˜¯å¦æ˜¾ç¤ºè¡¨æ ¼åŠŸèƒ½æŒ‰é’®ï¼Œæ”¯æŒï¼ˆ["refresh" \| "setting" \| "search"]ï¼‰ |
| rowKey       | String           | âŒ        | 'id'                                  | å½“è¡¨æ ¼æ•°æ®å¤šé€‰æ—¶ï¼Œæ‰€æŒ‡å®šçš„ id                                |
| searchCol    | Number \| Object | âŒ        | \{ xs: 1, sm: 2, md: 2, lg: 3, xl: 4 \} | è¡¨æ ¼æœç´¢é¡¹æ¯åˆ—å æ¯”é…ç½®                                       |

### 2ã€Column é…ç½®ï¼ˆColumnPropsï¼‰ï¼š

> ä½¿ç”¨ `v-bind="column"` é€šè¿‡å±æ€§é€ä¼ å°†æ¯ä¸€é¡¹ **column** å±æ€§å…¨éƒ¨é€ä¼ åˆ° **el-table-column** ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¯æŒ **el-table-column** çš„æ‰€æœ‰ **Props** å±æ€§ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜æ‰©å±•äº†ä»¥ä¸‹ **Propsï¼š**

| å±æ€§å       | ç±»å‹              | æ˜¯å¦å¿…ä¼  | é»˜è®¤å€¼ | å±æ€§æè¿°                                                     |
| ------------ | ----------------- | -------- | ------ | ------------------------------------------------------------ |
| type         | String            | âŒ        | â€”      | å¯¹åº”åˆ—çš„ç±»å‹ï¼ˆ"index" \| "selection" \| "radio" \| "expand" \| "sort"ï¼‰ |
| tag          | Boolean           | âŒ        | false  | å½“å‰å•å…ƒæ ¼å€¼æ˜¯å¦ä¸ºæ ‡ç­¾å±•ç¤ºï¼Œå¯é€šè¿‡ enum æ•°æ®ä¸­ tagType å­—æ®µæŒ‡å®š tag ç±»å‹ |
| isShow       | Boolean           | âŒ        | true   | å½“å‰åˆ—æ˜¯å¦æ˜¾ç¤ºåœ¨è¡¨æ ¼å†…ï¼ˆåªå¯¹ prop åˆ—ç”Ÿæ•ˆï¼‰                   |
| search       | SearchProps       | âŒ        | â€”      | æœç´¢é¡¹é…ç½®ï¼Œè¯¦æƒ…è§ SearchProps                               |
| enum         | Array \| Function | âŒ        | â€”      | å­—å…¸ï¼Œå¯æ ¼å¼åŒ–å•å…ƒæ ¼å†…å®¹ï¼Œè¿˜å¯ä»¥ä½œä¸ºæœç´¢æ¡†çš„ä¸‹æ‹‰é€‰é¡¹ï¼ˆå­—å…¸å¯ä»¥ä¸º API è¯·æ±‚å‡½æ•°ï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨æ‰§è¡Œï¼‰ |
| isFilterEnum | Boolean           | âŒ        | true   | å½“å‰å•å…ƒæ ¼å€¼æ˜¯å¦æ ¹æ® enum æ ¼å¼åŒ–ï¼ˆä¾‹å¦‚ enum åªä½œä¸ºæœç´¢é¡¹æ•°æ®ï¼Œä¸å‚ä¸å†…å®¹æ ¼å¼åŒ–ï¼‰ |
| fieldNames   | Object            | âŒ        | â€”      | æŒ‡å®š label && value && children çš„ key å€¼                    |
| headerRender | Function          | âŒ        | â€”      | è‡ªå®šä¹‰è¡¨å¤´å†…å®¹æ¸²æŸ“ï¼ˆtsx è¯­æ³•ã€h è¯­æ³•ï¼‰                       |
| render       | Function          | âŒ        | â€”      | è‡ªå®šä¹‰å•å…ƒæ ¼å†…å®¹æ¸²æŸ“ï¼ˆtsx è¯­æ³•ã€h è¯­æ³•ï¼‰                     |
| _children    | ColumnProps       | âŒ        | â€”      | å¤šçº§è¡¨å¤´                                                     |

### 3ã€æœç´¢é¡¹ é…ç½®ï¼ˆSearchPropsï¼‰ï¼š

> ä½¿ç”¨ `v-bind="column.search.propsâ€œ` é€šè¿‡å±æ€§é€ä¼ å°† **search.props** å±æ€§å…¨éƒ¨é€ä¼ åˆ°æ¯ä¸€é¡¹æœç´¢ç»„ä»¶ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¯æŒ **inputã€selectã€tree-selectã€date-packerã€time-pickerã€time-selectã€switch** å¤§éƒ¨åˆ†å±æ€§ï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šè¿˜æ‰©å±•äº†ä»¥ä¸‹ **Propsï¼š**

| å±æ€§å       | ç±»å‹     | æ˜¯å¦å¿…ä¼  | é»˜è®¤å€¼ | å±æ€§æè¿°                                                     |
| ------------ | -------- | -------- | ------ | ------------------------------------------------------------ |
| el           | String   | âŒ        | â€”      | å½“å‰é¡¹æœç´¢æ¡†çš„ç±»å‹ï¼Œæ”¯æŒï¼šinputã€input-numberã€selectã€select-v2ã€tree-selectã€cascaderã€date-pickerã€time-pickerã€time-selectã€switchã€slider |
| label        | String   | âŒ        | â€”      | å½“æœç´¢é¡¹ labelï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤å– column çš„ label             |
| props        | Object   | âŒ        | â€”      | æ ¹æ® element plus å®˜æ–¹æ–‡æ¡£æ¥ä¼ é€’ï¼Œè¯¥å±æ€§æ‰€æœ‰å€¼ä¼šé€ä¼ åˆ°ç»„ä»¶   |
| key          | String   | âŒ        | â€”      | å½“æœç´¢é¡¹ key ä¸ä¸º prop å±æ€§æ—¶ï¼Œå¯é€šè¿‡ key æŒ‡å®š               |
| tooltip      | String   | âŒ        | â€”      | æœç´¢æç¤º                                                     |
| order        | Number   | âŒ        | â€”      | æœç´¢é¡¹æ’åºï¼ˆä»å°åˆ°å¤§ï¼‰                                       |
| span         | Number   | âŒ        | 1      | æœç´¢é¡¹æ‰€å ç”¨çš„åˆ—æ•°ï¼Œé»˜è®¤ä¸º 1 åˆ—                              |
| offset       | Number   | âŒ        | â€”      | æœç´¢å­—æ®µå·¦ä¾§åç§»åˆ—æ•°                                         |
| defaultValue | Any      | âŒ        | â€”      | æœç´¢é¡¹é»˜è®¤å€¼ï¼ˆè¯¥å€¼é‡ç½®æ—¶ä¼šé‡ç½®å›åˆå§‹å€¼ï¼‰                     |
| render       | Function | âŒ        |        | è‡ªå®šä¹‰æœç´¢å†…å®¹æ¸²æŸ“ï¼ˆtsx è¯­æ³•ã€h è¯­æ³•ï¼‰                       |

### 4ã€ProTable äº‹ä»¶ï¼š

> æ ¹æ® **ElementPlus Table** æ–‡æ¡£åœ¨ **ProTable** ç»„ä»¶ä¸Šç»‘å®šäº‹ä»¶å³å¯ï¼Œç»„ä»¶ä¼šé€šè¿‡ **$attrs** é€ä¼ ç»™ **el-table**ã€‚
>
> [el-table äº‹ä»¶æ–‡æ¡£é“¾æ¥](https://link.juejin.cn?target=https%3A%2F%2Felement-plus.org%2Fzh-CN%2Fcomponent%2Ftable.html%23table-%E4%BA%8B%E4%BB%B6)

| äº‹ä»¶å   | æè¿°                     | å›è°ƒå‚æ•°               |
| -------- | ------------------------ | ---------------------- |
| dargSort | è¡¨æ ¼æ‹–æ‹½æ’åºæˆåŠŸåè§¦å‘ï¼Œ | \{ newIndex, oldIndex \} |
| search   | ç‚¹å‡»è¡¨æ ¼æœç´¢æŒ‰é’®æ—¶ä¼šè§¦å‘ | â€”                      |
| reset    | ç‚¹å‡»è¡¨æ ¼é‡ç½®æŒ‰é’®æ—¶ä¼šè§¦å‘ | â€”                      |

### 5ã€ProTable æ–¹æ³•ï¼š

> **ProTable** ç»„ä»¶æš´éœ²äº† **el-table** å®ä¾‹å’Œä¸€äº›ç»„ä»¶å†…éƒ¨çš„å‚æ•°å’Œæ–¹æ³•ï¼š
>
> [el-table æ–¹æ³•æ–‡æ¡£é“¾æ¥](https://link.juejin.cn?target=https%3A%2F%2Felement-plus.org%2Fzh-CN%2Fcomponent%2Ftable.html%23table-%E6%96%B9%E6%B3%95)

| æ–¹æ³•å              | æè¿°                                                         |
| ------------------- | ------------------------------------------------------------ |
| element             | `el-table` å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡`proTable.value.element.xxx()`æ¥è°ƒç”¨ `el-table` çš„æ‰€æœ‰æ–¹æ³• |
| tableData           | å½“å‰é¡µé¢æ‰€å±•ç¤ºçš„æ•°æ®                                         |
| radio               | å½“å‰è¡¨æ ¼å•é€‰å€¼ï¼ˆæŒ‡å®š type ä¸º "radio" æ—¶å¯å–åˆ°ï¼‰              |
| pageable            | å½“å‰è¡¨æ ¼çš„åˆ†é¡µæ•°æ®                                           |
| searchParam         | æ‰€æœ‰çš„æœç´¢å‚æ•°ï¼Œä¸åŒ…å«åˆ†é¡µ                                   |
| searchInitParam     | æ‰€æœ‰çš„æœç´¢åˆå§‹åŒ–é»˜è®¤çš„å‚æ•°                                   |
| getTableList        | è·å–ã€åˆ·æ–°è¡¨æ ¼æ•°æ®çš„æ–¹æ³•ï¼ˆæºå¸¦æ‰€æœ‰å‚æ•°ï¼‰                     |
| search              | è¡¨æ ¼æŸ¥è¯¢æ–¹æ³•ï¼Œç›¸å½“äºç‚¹å‡»æœç´¢æŒ‰é’®                             |
| reset               | é‡ç½®è¡¨æ ¼æŸ¥è¯¢å‚æ•°ï¼Œç›¸å½“äºç‚¹å‡»é‡ç½®æŒ‰é’®                         |
| handleSizeChange    | è¡¨æ ¼æ¯é¡µæ¡æ•°æ”¹å˜è§¦å‘çš„äº‹ä»¶                                   |
| handleCurrentChange | è¡¨æ ¼å½“å‰é¡µæ”¹å˜è§¦å‘çš„äº‹ä»¶                                     |
| clearSelection      | æ¸…ç©ºè¡¨æ ¼æ‰€é€‰æ‹©çš„æ•°æ®ï¼Œé™¤æ­¤æ–¹æ³•ä¹‹å¤–è¿˜å¯ä½¿ç”¨ `proTable.value.element.clearSelection()` |
| enumMap             | å½“å‰è¡¨æ ¼ä½¿ç”¨çš„æ‰€æœ‰å­—å…¸æ•°æ®ï¼ˆMap æ•°æ®ç»“æ„ï¼‰                   |
| isSelected          | è¡¨æ ¼æ˜¯å¦é€‰ä¸­æ•°æ®                                             |
| selectedList        | è¡¨æ ¼é€‰ä¸­çš„æ•°æ®åˆ—è¡¨                                           |
| selectedListIds     | è¡¨æ ¼é€‰ä¸­çš„æ•°æ®åˆ—è¡¨çš„ id                                      |

### 6ã€ProTable æ’æ§½ï¼š

| æ’æ§½å                   | æè¿°                                                         |
| ------------------------ | ------------------------------------------------------------ |
| â€”                        | é»˜è®¤æ’æ§½ï¼Œæ”¯æŒç›´æ¥åœ¨ ProTable ä¸­å†™ el-table-column æ ‡ç­¾      |
| tableHeader              | è‡ªå®šä¹‰è¡¨æ ¼å¤´éƒ¨å·¦ä¾§åŒºåŸŸçš„æ’æ§½ï¼Œä¸€èˆ¬æƒ…å†µè¯¥åŒºåŸŸæ”¾æ“ä½œæŒ‰é’®       |
| toolButton               | è‡ªå®šä¹‰è¡¨æ ¼å¤´éƒ¨å·¦å³ä¾§ä¾§åŠŸèƒ½åŒºåŸŸçš„æ’æ§½                         |
| append                   | æ’å…¥è‡³è¡¨æ ¼æœ€åä¸€è¡Œä¹‹åçš„å†…å®¹ï¼Œ å¦‚æœéœ€è¦å¯¹è¡¨æ ¼çš„å†…å®¹è¿›è¡Œæ— é™æ»šåŠ¨æ“ä½œï¼Œå¯èƒ½éœ€è¦ç”¨åˆ°è¿™ä¸ª slotã€‚ è‹¥è¡¨æ ¼æœ‰åˆè®¡è¡Œï¼Œè¯¥ slot ä¼šä½äºåˆè®¡è¡Œä¹‹ä¸Šã€‚ |
| empty                    | å½“è¡¨æ ¼æ•°æ®ä¸ºç©ºæ—¶è‡ªå®šä¹‰çš„å†…å®¹                                 |
| pagination               | åˆ†é¡µç»„ä»¶æ’æ§½                                                 |
| `column.prop`            | å•å…ƒæ ¼çš„ä½œç”¨åŸŸæ’æ§½                                           |
| `column.prop` + "Header" | è¡¨å¤´çš„ä½œç”¨åŸŸæ’æ§½                                             |

## å…­ã€ä»£ç å®ç° & åŸºç¡€ä½¿ç”¨ ğŸ’ªï¼ˆä»£ç è¾ƒå¤šï¼Œè¯¦æƒ…è¯·å»é¡¹ç›®é‡ŒæŸ¥çœ‹ï¼‰

### ä½¿ç”¨ä¸€æ®µè¯æ€»ç»“ä¸‹æˆ‘çš„æƒ³æ³•ï¼šğŸ“šğŸ“š

> ğŸ¤” **å‰æï¼šé¦–å…ˆæˆ‘ä»¬åœ¨å°è£… ProTable ç»„ä»¶çš„æ—¶å€™ï¼Œåœ¨ä¸å½±å“ el-table åŸæœ‰çš„å±æ€§ã€äº‹ä»¶ã€æ–¹æ³•çš„å‰æä¸‹ï¼Œç„¶ååœ¨å…¶åŸºç¡€ä¸ŠåšäºŒæ¬¡å°è£…ï¼Œå¦åˆ™åšå¾—å†å¥½ï¼Œä¹Ÿä¸å¤ªå®Œç¾ã€‚**

> ğŸ§ **æ€è·¯ï¼šæŠŠä¸€ä¸ªè¡¨æ ¼é¡µé¢æ‰€æœ‰é‡å¤çš„åŠŸèƒ½ ï¼ˆè¡¨æ ¼å¤šé€‰ã€æŸ¥è¯¢ã€é‡ç½®ã€åˆ·æ–°ã€åˆ†é¡µã€æ•°æ®æ“ä½œäºŒæ¬¡ç¡®è®¤ã€æ–‡ä»¶ä¸‹è½½ã€æ–‡ä»¶ä¸Šä¼ ï¼‰ éƒ½å°è£…æˆ Hooks å‡½æ•°é’©å­æˆ–ç»„ä»¶ï¼Œç„¶ååœ¨ ProTable ç»„ä»¶ä¸­ä½¿ç”¨è¿™äº›å‡½æ•°é’©å­æˆ–ç»„ä»¶ã€‚åœ¨é¡µé¢ä¸­ä½¿ç”¨çš„æ—¶ï¼Œåªéœ€ä¼ ç»™ ProTable å½“å‰è¡¨æ ¼æ•°æ®çš„è¯·æ±‚ APIã€è¡¨æ ¼é…ç½®é¡¹ columns å°±è¡Œäº†ï¼Œæ•°æ®ä¼ è¾“éƒ½ä½¿ç”¨ ä½œç”¨åŸŸæ’æ§½ æˆ– tsx è¯­æ³•ä» ProTable ä¼ é€’ç»™çˆ¶ç»„ä»¶å°±èƒ½åœ¨é¡µé¢ä¸Šè·å–åˆ°äº†ã€‚**

### 1ã€å¸¸ç”¨ Hooks å‡½æ•°

- **useTableï¼š**

```ts
import { Table } from "./interface";
import { reactive, computed, toRefs } from "vue";

/**
 * @description table é¡µé¢æ“ä½œæ–¹æ³•å°è£…
 * @param {Function} api è·å–è¡¨æ ¼æ•°æ® api æ–¹æ³• (å¿…ä¼ )
 * @param {Object} initParam è·å–æ•°æ®åˆå§‹åŒ–å‚æ•° (éå¿…ä¼ ï¼Œé»˜è®¤ä¸º{})
 * @param {Boolean} isPageable æ˜¯å¦æœ‰åˆ†é¡µ (éå¿…ä¼ ï¼Œé»˜è®¤ä¸ºtrue)
 * @param {Function} dataCallBack å¯¹åå°è¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†çš„æ–¹æ³• (éå¿…ä¼ )
 * */
export const useTable = (
  api?: (params: any) => Promise<any>,
  initParam: object = {},
  isPageable: boolean = true,
  dataCallBack?: (data: any) => any,
  requestError?: (error: any) => void
) => {
  const state = reactive<Table.StateProps>({
    // è¡¨æ ¼æ•°æ®
    tableData: [],
    // åˆ†é¡µæ•°æ®
    pageable: {
      // å½“å‰é¡µæ•°
      pageNum: 1,
      // æ¯é¡µæ˜¾ç¤ºæ¡æ•°
      pageSize: 10,
      // æ€»æ¡æ•°
      total: 0
    },
    // æŸ¥è¯¢å‚æ•°(åªåŒ…æ‹¬æŸ¥è¯¢)
    searchParam: {},
    // åˆå§‹åŒ–é»˜è®¤çš„æŸ¥è¯¢å‚æ•°
    searchInitParam: {},
    // æ€»å‚æ•°(åŒ…å«åˆ†é¡µå’ŒæŸ¥è¯¢å‚æ•°)
    totalParam: {}
  });

  /**
   * @description åˆ†é¡µæŸ¥è¯¢å‚æ•°(åªåŒ…æ‹¬åˆ†é¡µå’Œè¡¨æ ¼å­—æ®µæ’åº,å…¶ä»–æ’åºæ–¹å¼å¯è‡ªè¡Œé…ç½®)
   * */
  const pageParam = computed({
    get: () => {
      return {
        pageNum: state.pageable.pageNum,
        pageSize: state.pageable.pageSize
      };
    },
    set: (newVal: any) => {
      console.log("æˆ‘æ˜¯åˆ†é¡µæ›´æ–°ä¹‹åçš„å€¼", newVal);
    }
  });

  /**
   * @description è·å–è¡¨æ ¼æ•°æ®
   * @return void
   * */
  const getTableList = async () => {
    if (!api) return;
    try {
      // å…ˆæŠŠåˆå§‹åŒ–å‚æ•°å’Œåˆ†é¡µå‚æ•°æ”¾åˆ°æ€»å‚æ•°é‡Œé¢
      Object.assign(state.totalParam, initParam, isPageable ? pageParam.value : {});
      let { data } = await api({ ...state.searchInitParam, ...state.totalParam });
      dataCallBack && (data = dataCallBack(data));
      state.tableData = isPageable ? data.list : data;
      // è§£æ„åå°è¿”å›çš„åˆ†é¡µæ•°æ® (å¦‚æœæœ‰åˆ†é¡µæ›´æ–°åˆ†é¡µä¿¡æ¯)
      if (isPageable) {
        const { pageNum, pageSize, total } = data;
        updatePageable({ pageNum, pageSize, total });
      }
    } catch (error) {
      requestError && requestError(error);
    }
  };

  /**
   * @description æ›´æ–°æŸ¥è¯¢å‚æ•°
   * @return void
   * */
  const updatedTotalParam = () => {
    state.totalParam = {};
    // å¤„ç†æŸ¥è¯¢å‚æ•°ï¼Œå¯ä»¥ç»™æŸ¥è¯¢å‚æ•°åŠ è‡ªå®šä¹‰å‰ç¼€æ“ä½œ
    let nowSearchParam: Table.StateProps["searchParam"] = {};
    // é˜²æ­¢æ‰‹åŠ¨æ¸…ç©ºè¾“å…¥æ¡†æºå¸¦å‚æ•°ï¼ˆè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰æŸ¥è¯¢å‚æ•°å‰ç¼€ï¼‰
    for (let key in state.searchParam) {
      // æŸäº›æƒ…å†µä¸‹å‚æ•°ä¸º false/0 ä¹Ÿåº”è¯¥æºå¸¦å‚æ•°
      if (state.searchParam[key] || state.searchParam[key] === false || state.searchParam[key] === 0) {
        nowSearchParam[key] = state.searchParam[key];
      }
    }
    Object.assign(state.totalParam, nowSearchParam, isPageable ? pageParam.value : {});
  };

  /**
   * @description æ›´æ–°åˆ†é¡µä¿¡æ¯
   * @param {Object} pageable åå°è¿”å›çš„åˆ†é¡µæ•°æ®
   * @return void
   * */
  const updatePageable = (pageable: Table.Pageable) => {
    Object.assign(state.pageable, pageable);
  };

  /**
   * @description è¡¨æ ¼æ•°æ®æŸ¥è¯¢
   * @return void
   * */
  const search = () => {
    state.pageable.pageNum = 1;
    updatedTotalParam();
    getTableList();
  };

  /**
   * @description è¡¨æ ¼æ•°æ®é‡ç½®
   * @return void
   * */
  const reset = () => {
    state.pageable.pageNum = 1;
    // é‡ç½®æœç´¢è¡¨å•çš„æ—¶ï¼Œå¦‚æœæœ‰é»˜è®¤æœç´¢å‚æ•°ï¼Œåˆ™é‡ç½®é»˜è®¤çš„æœç´¢å‚æ•°
    state.searchParam = { ...state.searchInitParam };
    updatedTotalParam();
    getTableList();
  };

  /**
   * @description æ¯é¡µæ¡æ•°æ”¹å˜
   * @param {Number} val å½“å‰æ¡æ•°
   * @return void
   * */
  const handleSizeChange = (val: number) => {
    state.pageable.pageNum = 1;
    state.pageable.pageSize = val;
    getTableList();
  };

  /**
   * @description å½“å‰é¡µæ”¹å˜
   * @param {Number} val å½“å‰é¡µ
   * @return void
   * */
  const handleCurrentChange = (val: number) => {
    state.pageable.pageNum = val;
    getTableList();
  };

  return {
    ...toRefs(state),
    getTableList,
    search,
    reset,
    handleSizeChange,
    handleCurrentChange,
    updatedTotalParam
  };
};
```

- **useSelectionï¼š**

```ts
import { ref, computed } from "vue";

/**
 * @description è¡¨æ ¼å¤šé€‰æ•°æ®æ“ä½œ
 * @param {String} rowKey å½“è¡¨æ ¼å¯ä»¥å¤šé€‰æ—¶ï¼Œæ‰€æŒ‡å®šçš„ id
 * */
export const useSelection = (rowKey: string = "id") => {
  const isSelected = ref<boolean>(false);
  const selectedList = ref<{ [key: string]: any }[]>([]);

  // å½“å‰é€‰ä¸­çš„æ‰€æœ‰ ids æ•°ç»„
  const selectedListIds = computed((): string[] => {
    let ids: string[] = [];
    selectedList.value.forEach(item => ids.push(item[rowKey]));
    return ids;
  });

  /**
   * @description å¤šé€‰æ“ä½œ
   * @param {Array} rowArr å½“å‰é€‰æ‹©çš„æ‰€æœ‰æ•°æ®
   * @return void
   */
  const selectionChange = (rowArr: { [key: string]: any }[]) => {
    rowArr.length ? (isSelected.value = true) : (isSelected.value = false);
    selectedList.value = rowArr;
  };

  return {
    isSelected,
    selectedList,
    selectedListIds,
    selectionChange
  };
};
```

- **useDownloadï¼š**

```ts
import { ElNotification } from "element-plus";

/**
 * @description æ¥æ”¶æ•°æ®æµç”Ÿæˆ blobï¼Œåˆ›å»ºé“¾æ¥ï¼Œä¸‹è½½æ–‡ä»¶
 * @param {Function} api å¯¼å‡ºè¡¨æ ¼çš„apiæ–¹æ³• (å¿…ä¼ )
 * @param {String} tempName å¯¼å‡ºçš„æ–‡ä»¶å (å¿…ä¼ )
 * @param {Object} params å¯¼å‡ºçš„å‚æ•° (é»˜è®¤{})
 * @param {Boolean} isNotify æ˜¯å¦æœ‰å¯¼å‡ºæ¶ˆæ¯æç¤º (é»˜è®¤ä¸º true)
 * @param {String} fileType å¯¼å‡ºçš„æ–‡ä»¶æ ¼å¼ (é»˜è®¤ä¸º.xlsx)
 * */
export const useDownload = async (
  api: (param: any) => Promise<any>,
  tempName: string,
  params: any = {},
  isNotify: boolean = true,
  fileType: string = ".xlsx"
) => {
  if (isNotify) {
    ElNotification({
      title: "æ¸©é¦¨æç¤º",
      message: "å¦‚æœæ•°æ®åºå¤§ä¼šå¯¼è‡´ä¸‹è½½ç¼“æ…¢å“¦ï¼Œè¯·æ‚¨è€å¿ƒç­‰å¾…ï¼",
      type: "info",
      duration: 3000
    });
  }
  try {
    const res = await api(params);
    const blob = new Blob([res]);
    // å…¼å®¹ edge ä¸æ”¯æŒ createObjectURL æ–¹æ³•
    if ("msSaveOrOpenBlob" in navigator) return window.navigator.msSaveOrOpenBlob(blob, tempName + fileType);
    const blobUrl = window.URL.createObjectURL(blob);
    const exportFile = document.createElement("a");
    exportFile.style.display = "none";
    exportFile.download = `${tempName}${fileType}`;
    exportFile.href = blobUrl;
    document.body.appendChild(exportFile);
    exportFile.click();
    // å»é™¤ä¸‹è½½å¯¹ url çš„å½±å“
    document.body.removeChild(exportFile);
    window.URL.revokeObjectURL(blobUrl);
  } catch (error) {
    console.log(error);
  }
};
```

- **useHandleDataï¼š**

```ts
import { ElMessageBox, ElMessage } from "element-plus";
import { HandleData } from "./interface";

/**
 * @description æ“ä½œå•æ¡æ•°æ®ä¿¡æ¯ (äºŒæ¬¡ç¡®è®¤ã€åˆ é™¤ã€ç¦ç”¨ã€å¯ç”¨ã€é‡ç½®å¯†ç ã€‘)
 * @param {Function} api æ“ä½œæ•°æ®æ¥å£çš„apiæ–¹æ³• (å¿…ä¼ )
 * @param {Object} params æºå¸¦çš„æ“ä½œæ•°æ®å‚æ•° {id,params} (å¿…ä¼ )
 * @param {String} message æç¤ºä¿¡æ¯ (å¿…ä¼ )
 * @param {String} confirmType iconç±»å‹ (ä¸å¿…ä¼ ,é»˜è®¤ä¸º warning)
 * @returns {Promise}
 */
export const useHandleData = (
  api: (params: any) => Promise<any>,
  params: any = {},
  message: string,
  confirmType: HandleData.MessageType = "warning"
) => {
  return new Promise((resolve, reject) => {
    ElMessageBox.confirm(`æ˜¯å¦${message}?`, "æ¸©é¦¨æç¤º", {
      confirmButtonText: "ç¡®å®š",
      cancelButtonText: "å–æ¶ˆ",
      type: confirmType,
      draggable: true
    }).then(async () => {
      const res = await api(params);
      if (!res) return reject(false);
      ElMessage({
        type: "success",
        message: `${message}æˆåŠŸ!`
      });
      resolve(true);
    });
  });
};
```

### 2ã€Protable ç»„ä»¶ï¼š

- **ProTableï¼š**

```html
<template>
  <!-- æŸ¥è¯¢è¡¨å• -->
  <SearchForm
    v-show="isShowSearch"
    :search="_search"
    :reset="_reset"
    :columns="searchColumns"
    :search-param="searchParam"
    :search-col="searchCol"
  />

  <!-- è¡¨æ ¼ä¸»ä½“ -->
  <div class="card table-main">
    <!-- è¡¨æ ¼å¤´éƒ¨ æ“ä½œæŒ‰é’® -->
    <div class="table-header">
      <div class="header-button-lf">
        <slot name="tableHeader" :selected-list="selectedList" :selected-list-ids="selectedListIds" :is-selected="isSelected" />
      </div>
      <div v-if="toolButton" class="header-button-ri">
        <slot name="toolButton">
          <el-button v-if="showToolButton('refresh')" :icon="Refresh" circle @click="getTableList" />
          <el-button v-if="showToolButton('setting') && columns.length" :icon="Operation" circle @click="openColSetting" />
          <el-button
            v-if="showToolButton('search') && searchColumns?.length"
            :icon="Search"
            circle
            @click="isShowSearch = !isShowSearch"
          />
        </slot>
      </div>
    </div>
    <!-- è¡¨æ ¼ä¸»ä½“ -->
    <el-table
      ref="tableRef"
      v-bind="$attrs"
      :data="processTableData"
      :border="border"
      :row-key="rowKey"
      @selection-change="selectionChange"
    >
      <!-- é»˜è®¤æ’æ§½ -->
      <slot />
      <template v-for="item in tableColumns" :key="item">
        <!-- selection || radio || index || expand || sort -->
        <el-table-column
          v-if="item.type && columnTypes.includes(item.type)"
          v-bind="item"
          :align="item.align ?? 'center'"
          :reserve-selection="item.type == 'selection'"
        >
          <template #default="scope">
            <!-- expand -->
            <template v-if="item.type == 'expand'">
              <component :is="item.render" v-bind="scope" v-if="item.render" />
              <slot v-else :name="item.type" v-bind="scope" />
            </template>
            <!-- radio -->
            <el-radio v-if="item.type == 'radio'" v-model="radio" :label="scope.row[rowKey]">
              <i></i>
            </el-radio>
            <!-- sort -->
            <el-tag v-if="item.type == 'sort'" class="move">
              <el-icon> <DCaret /></el-icon>
            </el-tag>
          </template>
        </el-table-column>
        <!-- other -->
        <TableColumn v-if="!item.type && item.prop && item.isShow" :column="item">
          <template v-for="slot in Object.keys($slots)" #[slot]="scope">
            <slot :name="slot" v-bind="scope" />
          </template>
        </TableColumn>
      </template>
      <!-- æ’å…¥è¡¨æ ¼æœ€åä¸€è¡Œä¹‹åçš„æ’æ§½ -->
      <template #append>
        <slot name="append" />
      </template>
      <!-- æ— æ•°æ® -->
      <template #empty>
        <div class="table-empty">
          <slot name="empty">
            <img src="@/assets/images/notData.png" alt="notData" />
            <div>æš‚æ— æ•°æ®</div>
          </slot>
        </div>
      </template>
    </el-table>
    <!-- åˆ†é¡µç»„ä»¶ -->
    <slot name="pagination">
      <Pagination
        v-if="pagination"
        :pageable="pageable"
        :handle-size-change="handleSizeChange"
        :handle-current-change="handleCurrentChange"
      />
    </slot>
  </div>
  <!-- åˆ—è®¾ç½® -->
  <ColSetting v-if="toolButton" ref="colRef" v-model:col-setting="colSetting" />
</template>

<script setup lang="ts" name="ProTable">
import { ref, watch, provide, onMounted, unref, computed, reactive } from "vue";
import { ElTable } from "element-plus";
import { useTable } from "@/hooks/useTable";
import { useSelection } from "@/hooks/useSelection";
import { BreakPoint } from "@/components/Grid/interface";
import { ColumnProps, TypeProps } from "@/components/ProTable/interface";
import { Refresh, Operation, Search } from "@element-plus/icons-vue";
import { handleProp } from "@/utils";
import SearchForm from "@/components/SearchForm/index.vue";
import Pagination from "./components/Pagination.vue";
import ColSetting from "./components/ColSetting.vue";
import TableColumn from "./components/TableColumn.vue";
import Sortable from "sortablejs";

export interface ProTableProps {
  columns: ColumnProps[]; // åˆ—é…ç½®é¡¹  ==> å¿…ä¼ 
  data?: any[]; // é™æ€ table data æ•°æ®ï¼Œè‹¥å­˜åœ¨åˆ™ä¸ä¼šä½¿ç”¨ requestApi è¿”å›çš„ data ==> éå¿…ä¼ 
  requestApi?: (params: any) => Promise<any>; // è¯·æ±‚è¡¨æ ¼æ•°æ®çš„ api ==> éå¿…ä¼ 
  requestAuto?: boolean; // æ˜¯å¦è‡ªåŠ¨æ‰§è¡Œè¯·æ±‚ api ==> éå¿…ä¼ ï¼ˆé»˜è®¤ä¸ºtrueï¼‰
  requestError?: (params: any) => void; // è¡¨æ ¼ api è¯·æ±‚é”™è¯¯ç›‘å¬ ==> éå¿…ä¼ 
  dataCallback?: (data: any) => any; // è¿”å›æ•°æ®çš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œå¤„ç† ==> éå¿…ä¼ 
  title?: string; // è¡¨æ ¼æ ‡é¢˜ ==> éå¿…ä¼ 
  pagination?: boolean; // æ˜¯å¦éœ€è¦åˆ†é¡µç»„ä»¶ ==> éå¿…ä¼ ï¼ˆé»˜è®¤ä¸ºtrueï¼‰
  initParam?: any; // åˆå§‹åŒ–è¯·æ±‚å‚æ•° ==> éå¿…ä¼ ï¼ˆé»˜è®¤ä¸º{}ï¼‰
  border?: boolean; // æ˜¯å¦å¸¦æœ‰çºµå‘è¾¹æ¡† ==> éå¿…ä¼ ï¼ˆé»˜è®¤ä¸ºtrueï¼‰
  toolButton?: ("refresh" | "setting" | "search")[] | boolean; // æ˜¯å¦æ˜¾ç¤ºè¡¨æ ¼åŠŸèƒ½æŒ‰é’® ==> éå¿…ä¼ ï¼ˆé»˜è®¤ä¸ºtrueï¼‰
  rowKey?: string; // è¡Œæ•°æ®çš„ Keyï¼Œç”¨æ¥ä¼˜åŒ– Table çš„æ¸²æŸ“ï¼Œå½“è¡¨æ ¼æ•°æ®å¤šé€‰æ—¶ï¼Œæ‰€æŒ‡å®šçš„ id ==> éå¿…ä¼ ï¼ˆé»˜è®¤ä¸º idï¼‰
  searchCol?: number | Record<BreakPoint, number>; // è¡¨æ ¼æœç´¢é¡¹ æ¯åˆ—å æ¯”é…ç½® ==> éå¿…ä¼  { xs: 1, sm: 2, md: 2, lg: 3, xl: 4 }
}

// æ¥å—çˆ¶ç»„ä»¶å‚æ•°ï¼Œé…ç½®é»˜è®¤å€¼
const props = withDefaults(defineProps<ProTableProps>(), {
  columns: () => [],
  requestAuto: true,
  pagination: true,
  initParam: {},
  border: true,
  toolButton: true,
  rowKey: "id",
  searchCol: () => ({ xs: 1, sm: 2, md: 2, lg: 3, xl: 4 })
});

// table å®ä¾‹
const tableRef = ref<InstanceType<typeof ElTable>>();

// column åˆ—ç±»å‹
const columnTypes: TypeProps[] = ["selection", "radio", "index", "expand", "sort"];

// æ˜¯å¦æ˜¾ç¤ºæœç´¢æ¨¡å—
const isShowSearch = ref(true);

// æ§åˆ¶ ToolButton æ˜¾ç¤º
const showToolButton = (key: "refresh" | "setting" | "search") => {
  return Array.isArray(props.toolButton) ? props.toolButton.includes(key) : props.toolButton;
};

// å•é€‰å€¼
const radio = ref("");

// è¡¨æ ¼å¤šé€‰ Hooks
const { selectionChange, selectedList, selectedListIds, isSelected } = useSelection(props.rowKey);

// è¡¨æ ¼æ“ä½œ Hooks
const { tableData, pageable, searchParam, searchInitParam, getTableList, search, reset, handleSizeChange, handleCurrentChange } =
  useTable(props.requestApi, props.initParam, props.pagination, props.dataCallback, props.requestError);

// æ¸…ç©ºé€‰ä¸­æ•°æ®åˆ—è¡¨
const clearSelection = () => tableRef.value!.clearSelection();

// åˆå§‹åŒ–è¡¨æ ¼æ•°æ® && æ‹–æ‹½æ’åº
onMounted(() => {
  dragSort();
  props.requestAuto && getTableList();
  props.data && (pageable.value.total = props.data.length);
});

// å¤„ç†è¡¨æ ¼æ•°æ®
const processTableData = computed(() => {
  if (!props.data) return tableData.value;
  return props.data.slice(
    (pageable.value.pageNum - 1) * pageable.value.pageSize,
    pageable.value.pageSize * pageable.value.pageNum
  );
});

// ç›‘å¬é¡µé¢ initParam æ”¹åŒ–ï¼Œé‡æ–°è·å–è¡¨æ ¼æ•°æ®
watch(() => props.initParam, getTableList, { deep: true });

// æ¥æ”¶ columns å¹¶è®¾ç½®ä¸ºå“åº”å¼
const tableColumns = reactive<ColumnProps[]>(props.columns);

// æ‰å¹³åŒ– columns
const flatColumns = computed(() => flatColumnsFunc(tableColumns));

// å®šä¹‰ enumMap å­˜å‚¨ enum å€¼ï¼ˆé¿å…å¼‚æ­¥è¯·æ±‚æ— æ³•æ ¼å¼åŒ–å•å…ƒæ ¼å†…å®¹ || æ— æ³•å¡«å……æœç´¢ä¸‹æ‹‰é€‰æ‹©ï¼‰
const enumMap = ref(new Map<string, { [key: string]: any }[]>());
const setEnumMap = async ({ prop, enum: enumValue }: ColumnProps) => {
  if (!enumValue) return;

  // å¦‚æœå½“å‰ enumMap å­˜åœ¨ç›¸åŒçš„å€¼ return
  if (enumMap.value.has(prop!) && (typeof enumValue === "function" || enumMap.value.get(prop!) === enumValue)) return;

  // å½“å‰ enum ä¸ºé™æ€æ•°æ®ï¼Œåˆ™ç›´æ¥å­˜å‚¨åˆ° enumMap
  if (typeof enumValue !== "function") return enumMap.value.set(prop!, unref(enumValue!));
  
   // ä¸ºäº†é˜²æ­¢æ¥å£æ‰§è¡Œæ…¢ï¼Œè€Œå­˜å‚¨æ…¢ï¼Œå¯¼è‡´é‡å¤è¯·æ±‚ï¼Œæ‰€ä»¥é¢„å…ˆå­˜å‚¨ä¸º[]ï¼Œæ¥å£è¿”å›åå†äºŒæ¬¡å­˜å‚¨
  enumMap.value.set(prop!, []);

  // å½“å‰ enum ä¸ºåå°æ•°æ®éœ€è¦è¯·æ±‚æ•°æ®ï¼Œåˆ™è°ƒç”¨è¯¥è¯·æ±‚æ¥å£ï¼Œå¹¶å­˜å‚¨åˆ° enumMap
  const { data } = await enumValue();
  enumMap.value.set(prop!, data);
};

// æ³¨å…¥ enumMap
provide("enumMap", enumMap);

// æ‰å¹³åŒ– columns çš„æ–¹æ³•
const flatColumnsFunc = (columns: ColumnProps[], flatArr: ColumnProps[] = []) => {
  columns.forEach(async col => {
    if (col._children?.length) flatArr.push(...flatColumnsFunc(col._children));
    flatArr.push(col);

    // column æ·»åŠ é»˜è®¤ isShow && isFilterEnum å±æ€§å€¼
    col.isShow = col.isShow ?? true;
    col.isFilterEnum = col.isFilterEnum ?? true;

    // è®¾ç½® enumMap
    await setEnumMap(col);
  });
  return flatArr.filter(item => !item._children?.length);
};

// è¿‡æ»¤éœ€è¦æœç´¢çš„é…ç½®é¡¹ && æ’åº
const searchColumns = computed(() => {
  return flatColumns.value
    ?.filter(item => item.search?.el || item.search?.render)
    .sort((a, b) => a.search!.order! - b.search!.order!);
});

// è®¾ç½® æœç´¢è¡¨å•é»˜è®¤æ’åº && æœç´¢è¡¨å•é¡¹çš„é»˜è®¤å€¼
searchColumns.value?.forEach((column, index) => {
  column.search!.order = column.search?.order ?? index + 2;
  const key = column.search?.key ?? handleProp(column.prop!);
  const defaultValue = column.search?.defaultValue;
  if (defaultValue !== undefined && defaultValue !== null) {
    searchInitParam.value[key] = defaultValue;
    searchParam.value[key] = defaultValue;
  }
});

// åˆ—è®¾ç½® ==> éœ€è¦è¿‡æ»¤æ‰ä¸éœ€è¦è®¾ç½®çš„åˆ—
const colRef = ref();
const colSetting = tableColumns!.filter(item => {
  const { type, prop, isShow } = item;
  return !columnTypes.includes(type!) && prop !== "operation" && isShow;
});
const openColSetting = () => colRef.value.openColSetting();

// å®šä¹‰ emit äº‹ä»¶
const emit = defineEmits<{
  search: [];
  reset: [];
  dargSort: [{ newIndex?: number; oldIndex?: number }];
}>();

const _search = () => {
  search();
  emit("search");
};

const _reset = () => {
  reset();
  emit("reset");
};

// æ‹–æ‹½æ’åº
const dragSort = () => {
  const tbody = document.querySelector(".el-table__body-wrapper tbody") as HTMLElement;
  Sortable.create(tbody, {
    handle: ".move",
    animation: 300,
    onEnd({ newIndex, oldIndex }) {
      const [removedItem] = processTableData.value.splice(oldIndex!, 1);
      processTableData.value.splice(newIndex!, 0, removedItem);
      emit("dargSort", { newIndex, oldIndex });
    }
  });
};

// æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å‚æ•°å’Œæ–¹æ³• (å¤–éƒ¨éœ€è¦ä»€ä¹ˆï¼Œéƒ½å¯ä»¥ä»è¿™é‡Œæš´éœ²å‡ºå»)
defineExpose({
  element: tableRef,
  tableData: processTableData,
  radio,
  pageable,
  searchParam,
  searchInitParam,
  getTableList,
  search,
  reset,
  handleSizeChange,
  handleCurrentChange,
  clearSelection,
  enumMap,
  isSelected,
  selectedList,
  selectedListIds
});
</script>
```

- **TableColumnï¼š**

```html
<template>
  <RenderTableColumn v-bind="column" />
</template>

<script setup lang="tsx" name="TableColumn">
import { inject, ref, useSlots } from "vue";
import { ColumnProps, RenderScope, HeaderRenderScope } from "@/components/ProTable/interface";
import { filterEnum, formatValue, handleProp, handleRowAccordingToProp } from "@/utils";

defineProps<{ column: ColumnProps }>();

const slots = useSlots();

const enumMap = inject("enumMap", ref(new Map()));

// æ¸²æŸ“è¡¨æ ¼æ•°æ®
const renderCellData = (item: ColumnProps, scope: RenderScope<any>) => {
  return enumMap.value.get(item.prop) && item.isFilterEnum
    ? filterEnum(handleRowAccordingToProp(scope.row, item.prop!), enumMap.value.get(item.prop)!, item.fieldNames)
    : formatValue(handleRowAccordingToProp(scope.row, item.prop!));
};

// è·å– tag ç±»å‹
const getTagType = (item: ColumnProps, scope: RenderScope<any>) => {
  return filterEnum(handleRowAccordingToProp(scope.row, item.prop!), enumMap.value.get(item.prop), item.fieldNames, "tag");
};

const RenderTableColumn = (item: ColumnProps) => {
  return (
    <>
      {item.isShow && (
        <el-table-column
          {...item}
          align={item.align ?? "center"}
          showOverflowTooltip={item.showOverflowTooltip ?? item.prop !== "operation"}
        >
          {{
            default: (scope: RenderScope<any>) => {
              if (item._children) return item._children.map(child => RenderTableColumn(child));
              if (item.render) return item.render(scope);
              if (slots[handleProp(item.prop!)]) return slots[handleProp(item.prop!)]!(scope);
              if (item.tag) return <el-tag type={getTagType(item, scope)}>{renderCellData(item, scope)}</el-tag>;
              return renderCellData(item, scope);
            },
            header: (scope: HeaderRenderScope<any>) => {
              if (item.headerRender) return item.headerRender(scope);
              if (slots[`${handleProp(item.prop!)}Header`]) return slots[`${handleProp(item.prop!)}Header`]!(scope);
              return item.label;
            }
          }}
        </el-table-column>
      )}
    </>
  );
};
</script>
```

### 3ã€é¡µé¢ä½¿ç”¨ ProTable ç»„ä»¶ï¼š

```html
<template>
  <div class="table-box">
    <ProTable
      ref="proTable"
      :columns="columns"
      :request-api="getTableList"
      :init-param="initParam"
      :data-callback="dataCallback"
      @darg-sort="sortTable"
    >
      <!-- è¡¨æ ¼ header æŒ‰é’® -->
      <template #tableHeader="scope">
        <el-button v-auth="'add'" type="primary" :icon="CirclePlus" @click="openDrawer('æ–°å¢')">æ–°å¢ç”¨æˆ·</el-button>
        <el-button v-auth="'batchAdd'" type="primary" :icon="Upload" plain @click="batchAdd">æ‰¹é‡æ·»åŠ ç”¨æˆ·</el-button>
        <el-button v-auth="'export'" type="primary" :icon="Download" plain @click="downloadFile">å¯¼å‡ºç”¨æˆ·æ•°æ®</el-button>
        <el-button type="primary" plain @click="toDetail">To å­é›†è¯¦æƒ…é¡µé¢</el-button>
        <el-button type="danger" :icon="Delete" plain :disabled="!scope.isSelected" @click="batchDelete(scope.selectedListIds)">
          æ‰¹é‡åˆ é™¤ç”¨æˆ·
        </el-button>
      </template>
      <!-- Expand -->
      <template #expand="scope">
        {{ scope.row }}
      </template>
      <!-- usernameHeader -->
      <template #usernameHeader="scope">
        <el-button type="primary" @click="ElMessage.success('æˆ‘æ˜¯é€šè¿‡ä½œç”¨åŸŸæ’æ§½æ¸²æŸ“çš„è¡¨å¤´')">
          {{ scope.column.label }}
        </el-button>
      </template>
      <!-- createTime -->
      <template #createTime="scope">
        <el-button type="primary" link @click="ElMessage.success('æˆ‘æ˜¯é€šè¿‡ä½œç”¨åŸŸæ’æ§½æ¸²æŸ“çš„å†…å®¹')">
          {{ scope.row.createTime }}
        </el-button>
      </template>
      <!-- è¡¨æ ¼æ“ä½œ -->
      <template #operation="scope">
        <el-button type="primary" link :icon="View" @click="openDrawer('æŸ¥çœ‹', scope.row)">æŸ¥çœ‹</el-button>
        <el-button type="primary" link :icon="EditPen" @click="openDrawer('ç¼–è¾‘', scope.row)">ç¼–è¾‘</el-button>
        <el-button type="primary" link :icon="Refresh" @click="resetPass(scope.row)">é‡ç½®å¯†ç </el-button>
        <el-button type="primary" link :icon="Delete" @click="deleteAccount(scope.row)">åˆ é™¤</el-button>
      </template>
    </ProTable>
    <UserDrawer ref="drawerRef" />
    <ImportExcel ref="dialogRef" />
  </div>
</template>

<script setup lang="tsx" name="useProTable">
import { ref, reactive } from "vue";
import { useRouter } from "vue-router";
import { User } from "@/api/interface";
import { useHandleData } from "@/hooks/useHandleData";
import { useDownload } from "@/hooks/useDownload";
import { useAuthButtons } from "@/hooks/useAuthButtons";
import { ElMessage, ElMessageBox } from "element-plus";
import ProTable from "@/components/ProTable/index.vue";
import ImportExcel from "@/components/ImportExcel/index.vue";
import UserDrawer from "@/views/proTable/components/UserDrawer.vue";
import { ProTableInstance, ColumnProps, HeaderRenderScope } from "@/components/ProTable/interface";
import { CirclePlus, Delete, EditPen, Download, Upload, View, Refresh } from "@element-plus/icons-vue";
import {
  getUserList,
  deleteUser,
  editUser,
  addUser,
  changeUserStatus,
  resetUserPassWord,
  exportUserInfo,
  BatchAddUser,
  getUserStatus,
  getUserGender
} from "@/api/modules/user";

const router = useRouter();

// è·³è½¬è¯¦æƒ…é¡µ
const toDetail = () => {
  router.push(`/proTable/useProTable/detail/${Math.random().toFixed(3)}?params=detail-page`);
};

// ProTable å®ä¾‹
const proTable = ref<ProTableInstance>();

// å¦‚æœè¡¨æ ¼éœ€è¦åˆå§‹åŒ–è¯·æ±‚å‚æ•°ï¼Œç›´æ¥å®šä¹‰ä¼ ç»™ ProTable (ä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Šè¯¥å‚æ•°ï¼Œæ­¤å‚æ•°æ›´æ”¹ä¹‹åä¹Ÿä¼šä¸€ç›´å¸¦ä¸Šï¼Œæ”¹å˜æ­¤å‚æ•°ä¼šè‡ªåŠ¨åˆ·æ–°è¡¨æ ¼æ•°æ®)
const initParam = reactive({ type: 1 });

// dataCallback æ˜¯å¯¹äºè¿”å›çš„è¡¨æ ¼æ•°æ®åšå¤„ç†ï¼Œå¦‚æœä½ åå°è¿”å›çš„æ•°æ®ä¸æ˜¯ list && total && pageNum && pageSize è¿™äº›å­—æ®µï¼Œå¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œå¤„ç†æˆè¿™äº›å­—æ®µ
// æˆ–è€…ç›´æ¥å» hooks/useTable.ts æ–‡ä»¶ä¸­æŠŠå­—æ®µæ”¹ä¸ºä½ åç«¯å¯¹åº”çš„å°±è¡Œ
const dataCallback = (data: any) => {
  return {
    list: data.list,
    total: data.total,
    pageNum: data.pageNum,
    pageSize: data.pageSize
  };
};

// å¦‚æœä½ æƒ³åœ¨è¯·æ±‚ä¹‹å‰å¯¹å½“å‰è¯·æ±‚å‚æ•°åšä¸€äº›æ“ä½œï¼Œå¯ä»¥è‡ªå®šä¹‰å¦‚ä¸‹å‡½æ•°ï¼šparams ä¸ºå½“å‰æ‰€æœ‰çš„è¯·æ±‚å‚æ•°ï¼ˆåŒ…æ‹¬åˆ†é¡µï¼‰ï¼Œæœ€åè¿”å›è¯·æ±‚åˆ—è¡¨æ¥å£
// é»˜è®¤ä¸åšæ“ä½œå°±ç›´æ¥åœ¨ ProTable ç»„ä»¶ä¸Šç»‘å®š	:requestApi="getUserList"
const getTableList = (params: any) => {
  let newParams = JSON.parse(JSON.stringify(params));
  newParams.createTime && (newParams.startTime = newParams.createTime[0]);
  newParams.createTime && (newParams.endTime = newParams.createTime[1]);
  delete newParams.createTime;
  return getUserList(newParams);
};

// é¡µé¢æŒ‰é’®æƒé™ï¼ˆæŒ‰é’®æƒé™æ—¢å¯ä»¥ä½¿ç”¨ hooksï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ v-auth æŒ‡ä»¤ï¼ŒæŒ‡ä»¤é€‚åˆç›´æ¥ç»‘å®šåœ¨æŒ‰é’®ä¸Šï¼Œhooks é€‚åˆæ ¹æ®æŒ‰é’®æƒé™æ˜¾ç¤ºä¸åŒçš„å†…å®¹ï¼‰
const { BUTTONS } = useAuthButtons();

// è‡ªå®šä¹‰æ¸²æŸ“è¡¨å¤´ï¼ˆä½¿ç”¨tsxè¯­æ³•ï¼‰
const headerRender = (scope: HeaderRenderScope<User.ResUserList>) => {
  return (
    <el-button type="primary" onClick={() => ElMessage.success("æˆ‘æ˜¯é€šè¿‡ tsx è¯­æ³•æ¸²æŸ“çš„è¡¨å¤´")}>
      {scope.column.label}
    </el-button>
  );
};

// è¡¨æ ¼é…ç½®é¡¹
const columns = reactive<ColumnProps<User.ResUserList>[]>([
  { type: "selection", fixed: "left", width: 70 },
  { type: "sort", label: "Sort", width: 80 },
  { type: "expand", label: "Expand", width: 85 },
  {
    prop: "username",
    label: "ç”¨æˆ·å§“å",
    search: { el: "input", tooltip: "æˆ‘æ˜¯æœç´¢æç¤º" },
    render: scope => {
      return (
        <el-button type="primary" link onClick={() => ElMessage.success("æˆ‘æ˜¯é€šè¿‡ tsx è¯­æ³•æ¸²æŸ“çš„å†…å®¹")}>
          {scope.row.username}
        </el-button>
      );
    }
  },
  {
    prop: "gender",
    label: "æ€§åˆ«",
    // å­—å…¸æ•°æ®ï¼ˆæœ¬åœ°æ•°æ®ï¼‰
    // enum: genderType,
    // å­—å…¸è¯·æ±‚ä¸å¸¦å‚æ•°
    enum: getUserGender,
    // å­—å…¸è¯·æ±‚æºå¸¦å‚æ•°
    // enum: () => getUserGender({ id: 1 }),
    search: { el: "select", props: { filterable: true } },
    fieldNames: { label: "genderLabel", value: "genderValue" }
  },
  {
    // å¤šçº§ prop
    prop: "user.detail.age",
    label: "å¹´é¾„",
    search: {
      // è‡ªå®šä¹‰ search æ˜¾ç¤ºå†…å®¹
      render: ({ searchParam }) => {
        return (
          <div class="flx-center">
            <el-input vModel_trim={searchParam.minAge} placeholder="æœ€å°å¹´é¾„" />
            <span class="mr10 ml10">-</span>
            <el-input vModel_trim={searchParam.maxAge} placeholder="æœ€å¤§å¹´é¾„" />
          </div>
        );
      }
    }
  },
  { prop: "idCard", label: "èº«ä»½è¯å·", search: { el: "input" } },
  { prop: "email", label: "é‚®ç®±" },
  { prop: "address", label: "å±…ä½åœ°å€" },
  {
    prop: "status",
    label: "ç”¨æˆ·çŠ¶æ€",
    enum: getUserStatus,
    search: { el: "tree-select", props: { filterable: true } },
    fieldNames: { label: "userLabel", value: "userStatus" },
    render: scope => {
      return (
        <>
          {BUTTONS.value.status ? (
            <el-switch
              model-value={scope.row.status}
              active-text={scope.row.status ? "å¯ç”¨" : "ç¦ç”¨"}
              active-value={1}
              inactive-value={0}
              onClick={() => changeStatus(scope.row)}
            />
          ) : (
            <el-tag type={scope.row.status ? "success" : "danger"}>{scope.row.status ? "å¯ç”¨" : "ç¦ç”¨"}</el-tag>
          )}
        </>
      );
    }
  },
  {
    prop: "createTime",
    label: "åˆ›å»ºæ—¶é—´",
    headerRender,
    width: 180,
    search: {
      el: "date-picker",
      span: 2,
      props: { type: "datetimerange", valueFormat: "YYYY-MM-DD HH:mm:ss" },
      defaultValue: ["2022-11-12 11:35:00", "2022-12-12 11:35:00"]
    }
  },
  { prop: "operation", label: "æ“ä½œ", fixed: "right", width: 330 }
]);

// è¡¨æ ¼æ‹–æ‹½æ’åº
const sortTable = ({ newIndex, oldIndex }: { newIndex?: number; oldIndex?: number }) => {
  console.log(newIndex, oldIndex);
  console.log(proTable.value?.tableData);
  ElMessage.success("ä¿®æ”¹åˆ—è¡¨æ’åºæˆåŠŸ");
};

// åˆ é™¤ç”¨æˆ·ä¿¡æ¯
const deleteAccount = async (params: User.ResUserList) => {
  await useHandleData(deleteUser, { id: [params.id] }, `åˆ é™¤ã€${params.username}ã€‘ç”¨æˆ·`);
  proTable.value?.getTableList();
};

// æ‰¹é‡åˆ é™¤ç”¨æˆ·ä¿¡æ¯
const batchDelete = async (id: string[]) => {
  await useHandleData(deleteUser, { id }, "åˆ é™¤æ‰€é€‰ç”¨æˆ·ä¿¡æ¯");
  proTable.value?.clearSelection();
  proTable.value?.getTableList();
};

// é‡ç½®ç”¨æˆ·å¯†ç 
const resetPass = async (params: User.ResUserList) => {
  await useHandleData(resetUserPassWord, { id: params.id }, `é‡ç½®ã€${params.username}ã€‘ç”¨æˆ·å¯†ç `);
  proTable.value?.getTableList();
};

// åˆ‡æ¢ç”¨æˆ·çŠ¶æ€
const changeStatus = async (row: User.ResUserList) => {
  await useHandleData(changeUserStatus, { id: row.id, status: row.status == 1 ? 0 : 1 }, `åˆ‡æ¢ã€${row.username}ã€‘ç”¨æˆ·çŠ¶æ€`);
  proTable.value?.getTableList();
};

// å¯¼å‡ºç”¨æˆ·åˆ—è¡¨
const downloadFile = async () => {
  ElMessageBox.confirm("ç¡®è®¤å¯¼å‡ºç”¨æˆ·æ•°æ®?", "æ¸©é¦¨æç¤º", { type: "warning" }).then(() =>
    useDownload(exportUserInfo, "ç”¨æˆ·åˆ—è¡¨", proTable.value?.searchParam)
  );
};

// æ‰¹é‡æ·»åŠ ç”¨æˆ·
const dialogRef = ref<InstanceType<typeof ImportExcel> | null>(null);
const batchAdd = () => {
  const params = {
    title: "ç”¨æˆ·",
    tempApi: exportUserInfo,
    importApi: BatchAddUser,
    getTableList: proTable.value?.getTableList
  };
  dialogRef.value?.acceptParams(params);
};

// æ‰“å¼€ drawer(æ–°å¢ã€æŸ¥çœ‹ã€ç¼–è¾‘)
const drawerRef = ref<InstanceType<typeof UserDrawer> | null>(null);
const openDrawer = (title: string, row: Partial<User.ResUserList> = {}) => {
  const params = {
    title,
    isView: title === "æŸ¥çœ‹",
    row: { ...row },
    api: title === "æ–°å¢" ? addUser : title === "ç¼–è¾‘" ? editUser : undefined,
    getTableList: proTable.value?.getTableList
  };
  drawerRef.value?.acceptParams(params);
};
</script>
```

## ä¸ƒã€è´¡çŒ®è€… ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦

- [HalseySpicy](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHalseySpicy)
- [denganjia](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdenganjia)

